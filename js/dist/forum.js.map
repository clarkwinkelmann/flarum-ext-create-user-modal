{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@clarkwinkelmann/create-user-modal/webpack/bootstrap","webpack://@clarkwinkelmann/create-user-modal/webpack/runtime/compat get default export","webpack://@clarkwinkelmann/create-user-modal/webpack/runtime/define property getters","webpack://@clarkwinkelmann/create-user-modal/webpack/runtime/hasOwnProperty shorthand","webpack://@clarkwinkelmann/create-user-modal/webpack/runtime/make namespace object","webpack://@clarkwinkelmann/create-user-modal/external root \"flarum.core.compat['common/extend']\"","webpack://@clarkwinkelmann/create-user-modal/external root \"flarum.core.compat['forum/app']\"","webpack://@clarkwinkelmann/create-user-modal/external root \"flarum.core.compat['common/components/Button']\"","webpack://@clarkwinkelmann/create-user-modal/external root \"flarum.core.compat['forum/components/SessionDropdown']\"","webpack://@clarkwinkelmann/create-user-modal/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@clarkwinkelmann/create-user-modal/external root \"flarum.core.compat['forum/components/SignUpModal']\"","webpack://@clarkwinkelmann/create-user-modal/external root \"flarum.core.compat['forum/components/LogInButtons']\"","webpack://@clarkwinkelmann/create-user-modal/./src/forum/modals/CreateUserModal.ts","webpack://@clarkwinkelmann/create-user-modal/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@clarkwinkelmann/create-user-modal/./src/forum/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/SessionDropdown'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/SignUpModal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/LogInButtons'];","import app from 'flarum/forum/app';\nimport {ApiPayloadSingle} from 'flarum/common/Store';\nimport User from 'flarum/common/models/User';\nimport SignUpModal from 'flarum/forum/components/SignUpModal';\nimport LogInButtons from 'flarum/forum/components/LogInButtons';\n\nexport default class CreateUserModal extends SignUpModal {\n    title() {\n        return app.translator.trans('clarkwinkelmann-create-user-modal.forum.modal.title');\n    }\n\n    className(): string {\n        return super.className() + ' CreateUserModal';\n    }\n\n    content() {\n        // Same as original but without .Modal-footer\n        // We don't need to override the this.footer() method, it will just never be called\n        return [\n            m('.Modal-body', this.body()),\n        ];\n    }\n\n    body(): (false | JSX.Element)[] {\n        return super.body().filter(element => {\n            // If the element is the LogInButtons, remove it\n            if (element && element.tag === LogInButtons) {\n                return false;\n            }\n\n            // Otherwise keep everything else verbatim, even null/false/etc\n            return true;\n        });\n    }\n\n    fields() {\n        const items = super.fields();\n\n        if (items.has('submit')) {\n            const vdom: any = items.get('submit');\n\n            if (vdom && Array.isArray(vdom.children) && vdom.children.length > 0 && vdom.children[0]) {\n                vdom.children[0].children = [\n                    app.translator.trans('clarkwinkelmann-create-user-modal.forum.modal.submit'),\n                ];\n            }\n        }\n\n        return items;\n    }\n\n    // Instead of hitting /register (which would change which user is connected in this session)\n    // We just hit the API that's already used behind the scenes when registering\n    // Doing it this way skips connecting the new account and just returns the new user data\n    onsubmit(event: Event) {\n        event.preventDefault();\n\n        this.loading = true;\n\n        app.request<ApiPayloadSingle>({\n            url: app.forum.attribute('apiUrl') + '/users',\n            method: 'POST',\n            body: {\n                data: {\n                    attributes: this.submitData(),\n                },\n            },\n            errorHandler: this.onerror.bind(this)\n        }).then(\n            payload => {\n                const user = app.store.pushPayload<User>(payload);\n\n                // Add the missing groups relationship we can't include from the CreateUserController\n                // Without this there's an error trying to access the user edit modal just after the redirect to the profile\n                user.pushData({\n                    relationships: {\n                        groups: {\n                            data: [],\n                        },\n                    },\n                });\n\n                m.route.set(app.route.user(user));\n            },\n            this.loaded.bind(this)\n        );\n    }\n}\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","import {extend} from 'flarum/common/extend';\nimport app from 'flarum/forum/app';\nimport Button from 'flarum/common/components/Button';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport SessionDropdown from 'flarum/forum/components/SessionDropdown';\nimport CreateUserModal from './modals/CreateUserModal';\n\nexport {\n    CreateUserModal,\n};\n\napp.initializers.add('clarkwinkelmann-create-user-modal', () => {\n    const userDirectory: any = flarum.extensions['fof-user-directory'];\n\n    function addButton(items: ItemList<any>) {\n        if (!app.forum.attribute('clarkwinkelmannCreateUserModal')) {\n            return;\n        }\n\n        items.add('clarkwinkelmann-create-user-modal', Button.component({\n            icon: 'fas fa-user-plus',\n            className: 'Button',\n            onclick: () => {\n                app.modal.show(CreateUserModal);\n            },\n        }, app.translator.trans('clarkwinkelmann-create-user-modal.forum.link')), 10);\n    }\n\n    if (userDirectory && userDirectory.UserDirectoryPage) {\n        extend(userDirectory.UserDirectoryPage.prototype, 'actionItems', addButton);\n    } else {\n        extend(SessionDropdown.prototype, 'items', addButton);\n    }\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","CreateUserModal","subClass","superClass","create","constructor","title","app","className","content","m","this","body","filter","element","tag","LogInButtons","fields","items","has","vdom","Array","isArray","children","length","onsubmit","event","preventDefault","loading","url","method","data","attributes","submitData","errorHandler","onerror","then","payload","user","pushData","relationships","groups","route","set","loaded","SignUpModal","userDirectory","extensions","addButton","add","Button","icon","onclick","UserDirectoryPage","extend","SessionDropdown"],"sourceRoot":""}